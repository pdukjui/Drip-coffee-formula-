<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drip Coffee Simulator V-Cone</title>
<style>
body { font-family: 'Inter', sans-serif; padding: 20px; background: #f0f2f5; }
.container { max-width: 700px; margin: auto; background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
h2 { text-align: center; margin-bottom: 20px; }
select, input { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ccc; border-radius: 8px; }
button { padding: 14px; width: 100%; margin-top: 12px; font-size: 16px; border-radius: 10px; border: none; cursor: pointer; }
button.start { background: #4CAF50; color: #fff; }
button.pause { background: #ff9800; color: #fff; }
button.reset { background: #f44336; color: #fff; }
#timer { font-size: 36px; text-align: center; margin-top: 20px; font-weight: bold; color:#333; }
#recipeDesc { background:#f7f3ff; border-left:5px solid #9b59b6; padding:10px; border-radius:6px; margin-top:10px; white-space: pre-line; }
.step { margin-top: 12px; padding: 12px; background: #f0f6ff; border-radius: 10px; border-left: 6px solid #4a90e2; position: relative; }
.step-details { margin-top: 6px; font-size: 14px; color: #555; }
.progress-bar { position: absolute; bottom: 0; left: 0; height: 5px; background: #4CAF50; width: 0%; border-radius:0 0 6px 6px; transition: width 0.1s linear; }
.water-progress { margin-top: 6px; font-size: 14px; color: #333; }

.drip-container { position: relative; width: 200px; height: 300px; margin: 30px auto; }
.dripper { position: absolute; width: 100px; height: 80px; top: 0; left: 50%; transform: translateX(-50%); background: #bfa17c;
           clip-path: polygon(0 0, 100% 0, 50% 100%); border: 2px solid #8c6c3a; }
.carafe { position: absolute; width: 100px; height: 200px; bottom: 0; left: 50%; transform: translateX(-50%); border: 2px solid #333; border-radius: 0 0 15px 15px; background: #fff; overflow: hidden; }
.water { position: absolute; bottom: 0; width: 100%; height: 0%; background: linear-gradient(to top, #4B2E00, #A67C52); transition: height 0.05s linear; }
.scale { position: absolute; right: 105%; bottom:0; height:100%; width:40px; border-left:2px solid #555; }
.scale div { position:absolute; width:100%; text-align:right; font-size:12px; color:#555; transform: translateY(50%); }

.bubble { position: absolute; width: 6px; height: 6px; background: rgba(255,255,255,0.8); border-radius: 50%; opacity: 0.8; }
.steam { position: absolute; width: 8px; height: 20px; background: rgba(255,255,255,0.3); border-radius: 50%; animation: rise 2s linear infinite; }
@keyframes rise { 0% {transform: translateY(0) scaleX(1);} 50% {transform: translateY(-20px) scaleX(1.2);} 100% {transform: translateY(-40px) scaleX(1);} }

.drip { position: absolute; width: 6px; height: 6px; background: #4B2E00; border-radius: 50%; top:0; left:50%; transform: translateX(-50%); }
.ice { position: absolute; width: 16px; height: 16px; background: #a3d8f4; border-radius: 4px; opacity: 0.8; }
</style>
</head>
<body>
<div class="container">
<h2>üßã ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏£‡∏¥‡∏õ‡∏Å‡∏≤‡πÅ‡∏ü V-Cone</h2>

<label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≤‡πÅ‡∏ü:</label>
<select id="recipe">
  <option value="pourHot">Pour‚ÄëOver ‡∏£‡πâ‡∏≠‡∏ô</option>
  <option value="dripIce">Drip on Ice</option>
</select>

<p id="recipeDesc">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>

<label>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡πÅ‡∏ü (‡∏Å‡∏£‡∏±‡∏°):</label>
<input type="number" id="coffeeInput" value="15" />

<p id="waterResult">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‚Äî ml</p>

<button class="start" onclick="startBrewing()">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
<button class="pause" onclick="pauseBrewing()">‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
<button class="reset" onclick="resetBrewing()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>

<div id="timer">00:00</div>

<h3>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</h3>
<div id="steps"></div>

<div class="drip-container">
  <div class="dripper" id="dripper"></div>
  <div class="carafe" id="carafe">
    <div class="water" id="carafeWater"></div>
    <div class="scale" id="scale"></div>
  </div>
</div>
</div>

<audio id="stepSound">
  <source src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" type="audio/ogg">
</audio>
<audio id="dripSound">
  <source src="https://actions.google.com/sounds/v1/foley/drip.ogg" type="audio/ogg">
</audio>

<script>
const recipeDetails = {
pourHot:{description:`‡∏™‡∏π‡∏ï‡∏£ Pour‚ÄëOver ‡∏£‡πâ‡∏≠‡∏ô:\n- ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü:‡∏ô‡πâ‡∏≥ = 1:17\n- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥: 90‚Äì96¬∞C\n- ‡πÄ‡∏ô‡πâ‡∏ô‡∏ö‡∏≤‡∏•‡∏≤‡∏ô‡∏ã‡πå‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥`, ratio:17, steps:[{text:"Bloom",time:30},{text:"‡∏£‡∏¥‡∏ô‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á",time:60},{text:"‡∏£‡∏¥‡∏ô‡∏£‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢",time:90}]},
dripIce:{description:`‡∏™‡∏π‡∏ï‡∏£ Drip on Ice:\n- ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü:‡∏ô‡πâ‡∏≥ 1:10\n- ‡πÄ‡∏ó‡∏ô‡πâ‡∏≥‡∏£‡πâ‡∏≠‡∏ô‡∏ö‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏¢‡∏î‡∏•‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á\n- ‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô`, ratio:10, steps:[{text:"Bloom",time:30},{text:"‡∏£‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏•‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á",time:90},{text:"‡∏£‡∏¥‡∏ô‡∏£‡∏≠‡∏ö‡∏à‡∏ö",time:60}]}
};

const recipeSelect=document.getElementById('recipe');
const coffeeInput=document.getElementById('coffeeInput');
const recipeDesc=document.getElementById('recipeDesc');
const waterResult=document.getElementById('waterResult');
const stepSound=document.getElementById('stepSound');
const dripSound=document.getElementById('dripSound');
const carafeWater=document.getElementById('carafeWater');
const carafe=document.getElementById('carafe');
const scaleDiv=document.getElementById('scale');
const dripper=document.getElementById('dripper');

let paused=false, animationId, startTimeGlobal;
let dropInterval;

function updateRecipe(){ 
  const recipe=recipeSelect.value; 
  recipeDesc.innerText=recipeDetails[recipe].description; 
  updateWater();
}
function updateWater(){ 
  const coffee=Number(coffeeInput.value); 
  const recipe=recipeSelect.value; 
  const water=coffee*recipeDetails[recipe].ratio; 
  waterResult.innerText=`‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${water} ml`;
  createScale(water);
}
recipeSelect.addEventListener('change',updateRecipe);
coffeeInput.addEventListener('input',updateRecipe);

function createScale(totalWater){
  scaleDiv.innerHTML='';
  const steps = 10;
  for(let i=0;i<=steps;i++){
    const div=document.createElement('div');
    div.style.bottom=(i/steps*100)+'%';
    div.innerText=Math.round((i/steps)*totalWater)+' ml';
    scaleDiv.appendChild(div);
  }
}

function startBrewing(){
  resetBrewing(); paused=false;
  const recipe=recipeSelect.value;
  const steps=recipeDetails[recipe].steps;
  const coffeeAmount=Number(coffeeInput.value);
  const totalWater=coffeeAmount*recipeDetails[recipe].ratio;
  const totalTime=steps.reduce((a,b)=>a+b.time,0);
  startTimeGlobal=performance.now();

  const stepsDiv=document.getElementById('steps');
  stepsDiv.innerHTML='';
  let accumulatedTime=0, accumulatedWater=0;
  steps.forEach((step,index)=>{
    accumulatedTime+=step.time;
    accumulatedWater+=totalWater*(step.time/totalTime);
    const stepDiv=document.createElement('div');
    stepDiv.className='step';
    stepDiv.innerHTML=`<strong>${step.text}</strong>
      <div class="step-details">‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô: ${step.time} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ<br>‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: ${accumulatedTime} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ<br>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°: ${Math.round(accumulatedWater)} ml</div>
      <div class="progress-bar" id="progress-${index}"></div>
      <div class="water-progress" id="water-${index}">‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•: 0 ml</div>
      <span id="step-${index}">${step.time}</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
    stepsDiv.appendChild(stepDiv);
  });

  if(recipe==='dripIce'){
    for(let i=0;i<3;i++){
      const ice=document.createElement('div');
      ice.className='ice';
      ice.style.left=(20+Math.random()*60)+'%';
      ice.style.bottom=(Math.random()*30+10)+'%';
      carafe.appendChild(ice);
    }
  }

  const dropIntervalMs = 200;
  const dropsTotal = totalTime*1000/dropIntervalMs;
  const waterPerDrop = totalWater/dropsTotal;
  dropInterval=setInterval(()=>{ createDrop(waterPerDrop); },dropIntervalMs);

  animateSteps(recipe,totalWater,totalTime,steps);
}

function createDrop(waterPerDrop){
  if(paused) return;
  const drop=document.createElement('div');
  drop.className='drip';
  const dripperRect = dripper.getBoundingClientRect();
  const containerRect = document.querySelector('.drip-container').getBoundingClientRect();
  drop.style.left=(dripperRect.left - containerRect.left + dripperRect.width/2)+'px';
  drop.style.top='80px';
  document.querySelector('.drip-container').appendChild(drop);
  dripSound.currentTime=0; dripSound.play();

  let pos=0;
  const speed=2+Math.random()*1.5;
  function fall(){
    if(!drop.parentNode) return;
    pos+=speed;
    drop.style.top=(80+pos)+'px';
    if(pos>=carafe.offsetHeight-5){
      drop.remove();
      const currentHeight=parseFloat(carafeWater.style.height||0);
      const newHeight=Math.min(currentHeight + (waterPerDrop/parseFloat(coffeeInput.value*recipeDetails[recipeSelect.value].ratio))*100,100);
      carafeWater.style.height=newHeight+'%';
    } else requestAnimationFrame(fall);
  }
  fall();
}

function animateSteps(recipe,totalWater,totalTime,steps){
  function animate(time){
    if(!paused){
      let elapsedTotal=(time-startTimeGlobal)/1000;
      let cumulativeTime=0;
      steps.forEach((step,i)=>{
        const stepStart=cumulativeTime, stepElapsed=Math.max(0,Math.min(elapsedTotal-stepStart,step.time));
        const progressPercent=(stepElapsed/step.time)*100;
        document.getElementById(`progress-${i}`).style.width=progressPercent+'%';
        const waterSoFar=totalWater*(elapsedTotal/totalTime);
        document.getElementById(`water-${i}`).innerText=`‡∏ô‡πâ‡∏≥‡πÑ‡∏´‡∏•: ${Math.min(Math.round(waterSoFar),totalWater)} ml`;
        const timeLeft=Math.max(0,step.time-stepElapsed);
        document.getElementById(`step-${i}`).innerText=Math.round(timeLeft);
        if(timeLeft===5) stepSound.play();
        cumulativeTime+=step.time;
      });
      const remainingTime=Math.max(0,totalTime-elapsedTotal);
      document.getElementById('timer').innerText=`${String(Math.floor(remainingTime/60)).padStart(2,'0')}:${String(Math.floor(remainingTime%60)).padStart(2,'0')}`;

      createBubbles(100);
      createSteam(100);

      if(elapsedTotal<totalTime) animationId=requestAnimationFrame(animate);
      else clearInterval(dropInterval);
    }else animationId=requestAnimationFrame(animate);
  }
  animationId=requestAnimationFrame(animate);
}

function createBubbles(){ if(Math.random()<0.05){ const bubble=document.createElement('div'); bubble.className='bubble'; bubble.style.left=Math.random()*100+'%'; bubble.style.bottom='0px'; carafe.appendChild(bubble); let rise=0; function floatBubble(){ if(!bubble.parentNode) return; rise+=1; bubble.style.bottom=rise+'px'; bubble.style.opacity=1-rise/50; if(rise<50) requestAnimationFrame(floatBubble); else bubble.remove(); } floatBubble(); } }
function createSteam(){ if(Math.random()<0.03){ const steam=document.createElement('div'); steam.className='steam'; steam.style.left=(40+Math.random()*20)+'%'; steam.style.bottom='100%'; carafe.appendChild(steam); setTimeout(()=>steam.remove(),2000); } }

function pauseBrewing(){ paused=!paused; }
function resetBrewing(){ cancelAnimationFrame(animationId); clearInterval(dropInterval); document.getElementById('timer').innerText='00:00'; document.getElementById('steps').innerHTML=''; carafeWater.style.height='0%'; const oldIce=document.querySelectorAll('.ice'); oldIce.forEach(e=>e.remove()); const oldDrops=document.querySelectorAll('.drip'); oldDrops.forEach(e=>e.remove()); paused=false; }

updateRecipe();
</script>
</body>
</html>
